import React, { useState, useEffect, useRef, useCallback } from 'react';
import {
  View,
  Text,
  Modal,
  TouchableOpacity,
  StyleSheet,
  FlatList,
  TextInput,
  Image,
  ScrollView,
  ActivityIndicator,
  Dimensions,
  Platform,
} from 'react-native';
import { colors, darkColors, lightColors } from '../theme/colors';
import { usePreferences } from '../state/preferences';

interface EmojiGifPickerModalProps {
  onEmojiSelect: (emoji: string) => void;
  onGifSelect: (gifUrl: string, gifTitle: string) => void;
  onClose: () => void;
  isOpen: boolean;
  initialTab?: 'emoji' | 'gif';
}

interface GifData {
  id: string;
  title: string;
  images: {
    fixed_width?: {
      url: string;
      width: string;
      height: string;
    };
    downsized_medium?: {
      url: string;
      width: string;
      height: string;
    };
    downsized?: {
      url: string;
      width: string;
      height: string;
    };
    original: {
      url: string;
      width: string;
      height: string;
    };
  };
}

const EMOJI_CATEGORIES = [
  { name: 'Smileys & People', emojis: ['ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜', 'ğŸ˜†', 'ğŸ˜…', 'ğŸ˜‚', 'ğŸ¤£', 'ğŸ˜Š', 'ğŸ˜‡', 'ğŸ™‚', 'ğŸ™ƒ', 'ğŸ˜‰', 'ğŸ˜Œ', 'ğŸ˜', 'ğŸ¥°', 'ğŸ˜˜', 'ğŸ˜—', 'ğŸ˜™', 'ğŸ˜š', 'ğŸ˜‹', 'ğŸ˜›', 'ğŸ˜', 'ğŸ˜œ', 'ğŸ¤ª', 'ğŸ¤¨', 'ğŸ§', 'ğŸ¤“', 'ğŸ˜', 'ğŸ¤©', 'ğŸ¥³', 'ğŸ˜', 'ğŸ˜’', 'ğŸ˜', 'ğŸ˜”', 'ğŸ˜Ÿ', 'ğŸ˜•', 'ğŸ™', 'â˜¹ï¸', 'ğŸ˜£', 'ğŸ˜–', 'ğŸ˜«', 'ğŸ˜©', 'ğŸ¥º', 'ğŸ˜¢', 'ğŸ˜­', 'ğŸ˜¤', 'ğŸ˜ ', 'ğŸ˜¡', 'ğŸ¤¬', 'ğŸ¤¯', 'ğŸ˜³', 'ğŸ¥µ', 'ğŸ¥¶', 'ğŸ˜±', 'ğŸ˜¨', 'ğŸ˜°', 'ğŸ˜¥', 'ğŸ˜“', 'ğŸ¤—', 'ğŸ¤”', 'ğŸ¤­', 'ğŸ¤«', 'ğŸ¤¥', 'ğŸ˜¶', 'ğŸ˜', 'ğŸ˜‘', 'ğŸ˜¬', 'ğŸ™„', 'ğŸ˜¯', 'ğŸ˜¦', 'ğŸ˜§', 'ğŸ˜®', 'ğŸ˜²', 'ğŸ¥±', 'ğŸ˜´', 'ğŸ¤¤', 'ğŸ˜ª', 'ğŸ˜µ', 'ğŸ¤', 'ğŸ¥´', 'ğŸ¤¢', 'ğŸ¤®', 'ğŸ¤§', 'ğŸ˜·', 'ğŸ¤’', 'ğŸ¤•', 'ğŸ¤‘', 'ğŸ¤ ', 'ğŸ˜ˆ', 'ğŸ‘¿', 'ğŸ‘¹', 'ğŸ‘º', 'ğŸ¤¡', 'ğŸ’©', 'ğŸ‘»', 'ğŸ’€', 'â˜ ï¸', 'ğŸ‘½', 'ğŸ‘¾', 'ğŸ¤–', 'ğŸƒ', 'ğŸ˜º', 'ğŸ˜¸', 'ğŸ˜¹', 'ğŸ˜»', 'ğŸ˜¼', 'ğŸ˜½', 'ğŸ™€', 'ğŸ˜¿', 'ğŸ˜¾'] },
  { name: 'Animals & Nature', emojis: ['ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ¨', 'ğŸ¯', 'ğŸ¦', 'ğŸ®', 'ğŸ·', 'ğŸ½', 'ğŸ¸', 'ğŸµ', 'ğŸ™ˆ', 'ğŸ™‰', 'ğŸ™Š', 'ğŸ’', 'ğŸ¦', 'ğŸ¦§', 'ğŸ•', 'ğŸ©', 'ğŸ¦®', 'ğŸ•â€ğŸ¦º', 'ğŸˆ', 'ğŸˆâ€â¬›', 'ğŸ¦„', 'ğŸ', 'ğŸ¦“', 'ğŸ¦Œ', 'ğŸ‚', 'ğŸƒ', 'ğŸ„', 'ğŸª', 'ğŸ«', 'ğŸ¦™', 'ğŸ¦’', 'ğŸ˜', 'ğŸ¦', 'ğŸ¦›', 'ğŸ', 'ğŸ‘', 'ğŸ', 'ğŸ–', 'ğŸ—', 'ğŸ½', 'ğŸ“', 'ğŸ¦ƒ', 'ğŸ¦š', 'ğŸ¦œ', 'ğŸ¦¢', 'ğŸ¦©', 'ğŸ•Šï¸', 'ğŸ‡', 'ğŸ¦', 'ğŸ¦¨', 'ğŸ¦¡', 'ğŸ¦¦', 'ğŸ¦¥', 'ğŸ', 'ğŸ€', 'ğŸ¿ï¸', 'ğŸ¦”', 'ğŸ¾', 'ğŸ‰', 'ğŸ²', 'ğŸŒµ', 'ğŸ„', 'ğŸŒ²', 'ğŸŒ³', 'ğŸŒ´', 'ğŸŒ±', 'ğŸŒ¿', 'â˜˜ï¸', 'ğŸ€', 'ğŸ', 'ğŸ‹', 'ğŸƒ', 'ğŸ‚', 'ğŸ', 'ğŸ„', 'ğŸš', 'ğŸŒ¾', 'ğŸ’', 'ğŸŒ·', 'ğŸŒ¹', 'ğŸ¥€', 'ğŸŒº', 'ğŸŒ¸', 'ğŸŒ¼', 'ğŸŒ»', 'ğŸŒ', 'ğŸŒ', 'ğŸŒ›', 'ğŸŒœ', 'ğŸŒš', 'ğŸŒ•', 'ğŸŒ–', 'ğŸŒ—', 'ğŸŒ˜', 'ğŸŒ‘', 'ğŸŒ’', 'ğŸŒ“', 'ğŸŒ”', 'ğŸŒ™', 'â­', 'ğŸŒŸ', 'ğŸ’«', 'âœ¨', 'â˜„ï¸', 'â˜€ï¸', 'ğŸŒ¤ï¸', 'â›…', 'ğŸŒ¥ï¸', 'â˜ï¸', 'ğŸŒ¦ï¸', 'ğŸŒ§ï¸', 'â›ˆï¸', 'ğŸŒ©ï¸', 'ğŸŒ¨ï¸', 'â„ï¸', 'â˜ƒï¸', 'â›„', 'ğŸŒ¬ï¸', 'ğŸ’¨', 'ğŸ’§', 'ğŸ’¦', 'â˜”', 'â˜‚ï¸', 'ğŸŒŠ', 'ğŸŒ«ï¸'] },
  { name: 'Food & Drink', emojis: ['ğŸ', 'ğŸ', 'ğŸŠ', 'ğŸ‹', 'ğŸŒ', 'ğŸ‰', 'ğŸ‡', 'ğŸ“', 'ğŸ«', 'ğŸˆ', 'ğŸ’', 'ğŸ‘', 'ğŸ¥­', 'ğŸ', 'ğŸ¥¥', 'ğŸ¥', 'ğŸ…', 'ğŸ†', 'ğŸ¥‘', 'ğŸ¥¦', 'ğŸ¥¬', 'ğŸ¥’', 'ğŸŒ¶ï¸', 'ğŸ«’', 'ğŸŒ½', 'ğŸ¥•', 'ğŸ«‘', 'ğŸ¥”', 'ğŸ ', 'ğŸ¥', 'ğŸ¥–', 'ğŸ', 'ğŸ¥¨', 'ğŸ¥¯', 'ğŸ§€', 'ğŸ¥š', 'ğŸ³', 'ğŸ§ˆ', 'ğŸ¥', 'ğŸ§‡', 'ğŸ¥“', 'ğŸ¥©', 'ğŸ—', 'ğŸ–', 'ğŸ¦´', 'ğŸŒ­', 'ğŸ”', 'ğŸŸ', 'ğŸ•', 'ğŸ«“', 'ğŸ¥™', 'ğŸŒ®', 'ğŸŒ¯', 'ğŸ«”', 'ğŸ¥—', 'ğŸ¥˜', 'ğŸ«•', 'ğŸ¥«', 'ğŸ', 'ğŸœ', 'ğŸ²', 'ğŸ›', 'ğŸ£', 'ğŸ±', 'ğŸ¥Ÿ', 'ğŸ¦ª', 'ğŸ¤', 'ğŸ™', 'ğŸš', 'ğŸ˜', 'ğŸ¥', 'ğŸ¥ ', 'ğŸ¥®', 'ğŸ¢', 'ğŸ¡', 'ğŸ§', 'ğŸ¨', 'ğŸ¦', 'ğŸ¥§', 'ğŸ§', 'ğŸ°', 'ğŸ‚', 'ğŸ®', 'ğŸ­', 'ğŸ¬', 'ğŸ«', 'ğŸ¿', 'ğŸ©', 'ğŸª', 'ğŸŒ°', 'ğŸ¥œ', 'ğŸ¯', 'ğŸ¥›', 'ğŸ¼', 'â˜•', 'ğŸ«–', 'ğŸµ', 'ğŸ§ƒ', 'ğŸ¥¤', 'ğŸ§‹', 'ğŸ«', 'ğŸ§Š', 'ğŸ¥ƒ', 'ğŸº', 'ğŸ»', 'ğŸ¥‚', 'ğŸ·', 'ğŸ¥´', 'ğŸ¸', 'ğŸ¹', 'ğŸ§‰', 'ğŸ¾', 'ğŸ§Š'] },
  { name: 'Activities', emojis: ['âš½', 'ğŸ€', 'ğŸˆ', 'âš¾', 'ğŸ¥', 'ğŸ¾', 'ğŸ', 'ğŸ‰', 'ğŸ±', 'ğŸª€', 'ğŸ“', 'ğŸ¸', 'ğŸ’', 'ğŸ‘', 'ğŸ¥', 'ğŸ', 'ğŸªƒ', 'ğŸ¥…', 'â›³', 'ğŸª', 'ğŸ¹', 'ğŸ£', 'ğŸ¤¿', 'ğŸ¥Š', 'ğŸ¥‹', 'ğŸ½', 'ğŸ›¹', 'ğŸ›·', 'â›¸ï¸', 'ğŸ¥Œ', 'ğŸ¿', 'â›·ï¸', 'ğŸ‚', 'ğŸª‚', 'ğŸ‹ï¸â€â™€ï¸', 'ğŸ‹ï¸', 'ğŸ‹ï¸â€â™‚ï¸', 'ğŸ¤¼â€â™€ï¸', 'ğŸ¤¼', 'ğŸ¤¼â€â™‚ï¸', 'ğŸ¤¸â€â™€ï¸', 'ğŸ¤¸', 'ğŸ¤¸â€â™‚ï¸', 'â›¹ï¸â€â™€ï¸', 'â›¹ï¸', 'â›¹ï¸â€â™‚ï¸', 'ğŸ¤º', 'ğŸ¤¾â€â™€ï¸', 'ğŸ¤¾', 'ğŸ¤¾â€â™‚ï¸', 'ğŸŒï¸â€â™€ï¸', 'ğŸŒï¸', 'ğŸŒï¸â€â™‚ï¸', 'ğŸ‡', 'ğŸ§˜â€â™€ï¸', 'ğŸ§˜', 'ğŸ§˜â€â™‚ï¸', 'ğŸ„â€â™€ï¸', 'ğŸ„', 'ğŸ„â€â™‚ï¸', 'ğŸŠâ€â™€ï¸', 'ğŸŠ', 'ğŸŠâ€â™‚ï¸', 'ğŸ¤½â€â™€ï¸', 'ğŸ¤½', 'ğŸ¤½â€â™‚ï¸', 'ğŸš£â€â™€ï¸', 'ğŸš£', 'ğŸš£â€â™‚ï¸', 'ğŸ§—â€â™€ï¸', 'ğŸ§—', 'ğŸ§—â€â™‚ï¸', 'ğŸšµâ€â™€ï¸', 'ğŸšµ', 'ğŸšµâ€â™‚ï¸', 'ğŸš´â€â™€ï¸', 'ğŸš´', 'ğŸš´â€â™‚ï¸', 'ğŸ†', 'ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', 'ğŸ…', 'ğŸ–ï¸', 'ğŸµï¸', 'ğŸ—ï¸', 'ğŸ«', 'ğŸŸï¸', 'ğŸª', 'ğŸ¤¹', 'ğŸ¤¹â€â™€ï¸', 'ğŸ¤¹â€â™‚ï¸', 'ğŸ­', 'ğŸ©°', 'ğŸ¨', 'ğŸ¬', 'ğŸ¤', 'ğŸ§', 'ğŸ¼', 'ğŸµ', 'ğŸ¶', 'ğŸª˜', 'ğŸ¥', 'ğŸª—', 'ğŸ¸', 'ğŸª•', 'ğŸº', 'ğŸ·', 'ğŸª—', 'ğŸ¹', 'ğŸ»', 'ğŸ²', 'â™Ÿï¸', 'ğŸ¯', 'ğŸ³', 'ğŸ®', 'ğŸ•¹ï¸', 'ğŸ°', 'ğŸ²'] },
  { name: 'Travel & Places', emojis: ['ğŸš—', 'ğŸš•', 'ğŸš™', 'ğŸšŒ', 'ğŸš', 'ğŸï¸', 'ğŸš“', 'ğŸš‘', 'ğŸš’', 'ğŸš', 'ğŸ›»', 'ğŸšš', 'ğŸš›', 'ğŸšœ', 'ğŸï¸', 'ğŸ›µ', 'ğŸš²', 'ğŸ›´', 'ğŸ›¹', 'ğŸ›¼', 'ğŸš', 'ğŸ›¸', 'âœˆï¸', 'ğŸ›©ï¸', 'ğŸ›«', 'ğŸ›¬', 'ğŸª‚', 'ğŸ’º', 'ğŸš€', 'ğŸ›°ï¸', 'ğŸš‰', 'ğŸš', 'ğŸš', 'ğŸš„', 'ğŸš…', 'ğŸšˆ', 'ğŸš‚', 'ğŸš†', 'ğŸš‡', 'ğŸšŠ', 'ğŸš', 'ğŸš˜', 'ğŸš–', 'ğŸš¡', 'ğŸš ', 'ğŸšŸ', 'ğŸ¢', 'ğŸ¡', 'ğŸ ', 'â›µ', 'ğŸ›¥ï¸', 'ğŸš¤', 'â›´ï¸', 'ğŸ›³ï¸', 'ğŸš¢', 'âš“', 'ğŸš§', 'â›½', 'ğŸš¨', 'ğŸš¥', 'ğŸš¦', 'ğŸ›‘', 'ğŸš', 'ğŸ—ºï¸', 'ğŸ—¿', 'ğŸ—½', 'ğŸ—¼', 'ğŸ°', 'ğŸ¯', 'ğŸŸï¸', 'ğŸ¡', 'ğŸ¢', 'ğŸ ', 'â›²', 'â›±ï¸', 'ğŸ–ï¸', 'ğŸï¸', 'ğŸ”ï¸', 'â›°ï¸', 'ğŸŒ‹', 'ğŸ—»', 'ğŸ•ï¸', 'â›º', 'ğŸ›–', 'ğŸ ', 'ğŸ¡', 'ğŸ˜ï¸', 'ğŸšï¸', 'ğŸ—ï¸', 'ğŸ­', 'ğŸ¢', 'ğŸ¬', 'ğŸ£', 'ğŸ¤', 'ğŸ¥', 'ğŸ¦', 'ğŸ¨', 'ğŸª', 'ğŸ«', 'ğŸ©', 'ğŸ’’', 'ğŸ›ï¸', 'â›ª', 'ğŸ•Œ', 'ğŸ•', 'ğŸ›•', 'ğŸ•‹', 'â›©ï¸', 'ğŸ›¤ï¸', 'ğŸ›£ï¸', 'ğŸ—¾', 'ğŸ‘', 'ğŸï¸', 'ğŸŒ…', 'ğŸŒ„', 'ğŸŒ ', 'ğŸ‡', 'ğŸ†', 'ğŸŒ‡', 'ğŸŒ†', 'ğŸ™ï¸', 'ğŸŒƒ', 'ğŸŒŒ', 'ğŸŒ‰', 'ğŸŒ'] },
  { name: 'Objects', emojis: ['âŒš', 'ğŸ“±', 'ğŸ“²', 'ğŸ’»', 'âŒ¨ï¸', 'ğŸ–¥ï¸', 'ğŸ–¨ï¸', 'ğŸ–±ï¸', 'ğŸ–²ï¸', 'ğŸ•¹ï¸', 'ğŸ—œï¸', 'ğŸ’½', 'ğŸ’¾', 'ğŸ’¿', 'ğŸ“€', 'ğŸ“¼', 'ğŸ“·', 'ğŸ“¸', 'ğŸ“¹', 'ğŸ¥', 'ğŸ“½ï¸', 'ğŸï¸', 'ğŸ“', 'â˜ï¸', 'ğŸ“Ÿ', 'ğŸ“ ', 'ğŸ“º', 'ğŸ“»', 'ğŸ™ï¸', 'ğŸšï¸', 'ğŸ›ï¸', 'ğŸ§­', 'â±ï¸', 'â²ï¸', 'â°', 'ğŸ•°ï¸', 'âŒ›', 'â³', 'ğŸ“¡', 'ğŸ”‹', 'ğŸ”Œ', 'ğŸ’¡', 'ğŸ”¦', 'ğŸ•¯ï¸', 'ğŸª”', 'ğŸ§¯', 'ğŸ›¢ï¸', 'ğŸ’¸', 'ğŸ’µ', 'ğŸ’´', 'ğŸ’¶', 'ğŸ’·', 'ğŸ’°', 'ğŸ’³', 'ğŸ’', 'âš–ï¸', 'ğŸ§°', 'ğŸ”§', 'ğŸ”¨', 'âš’ï¸', 'ğŸ› ï¸', 'â›ï¸', 'ğŸª“', 'ğŸªš', 'ğŸ”©', 'âš™ï¸', 'ğŸª¤', 'ğŸ§±', 'â›“ï¸', 'ğŸ§²', 'ğŸ”«', 'ğŸ’£', 'ğŸ§¨', 'ğŸª“', 'ğŸ”ª', 'ğŸ—¡ï¸', 'âš”ï¸', 'ğŸ›¡ï¸', 'ğŸš¬', 'âš°ï¸', 'ğŸª¦', 'âš±ï¸', 'ğŸº', 'ğŸ”®', 'ğŸ“¿', 'ğŸ§¿', 'ğŸ’ˆ', 'âš—ï¸', 'ğŸ”­', 'ğŸ”¬', 'ğŸ•³ï¸', 'ğŸ©¹', 'ğŸ©º', 'ğŸ’Š', 'ğŸ’‰', 'ğŸ§¬', 'ğŸ¦ ', 'ğŸ§«', 'ğŸ§ª', 'ğŸŒ¡ï¸', 'ğŸ§¹', 'ğŸ§º', 'ğŸ§»', 'ğŸš½', 'ğŸš°', 'ğŸš¿', 'ğŸ›', 'ğŸ›€', 'ğŸ§´', 'ğŸ§·', 'ğŸ§¸', 'ğŸ§µ', 'ğŸª¡', 'ğŸª¢', 'ğŸ§¶', 'ğŸª£', 'ğŸª¤', 'ğŸª¥', 'ğŸª¦', 'ğŸª§'] },
  { name: 'Symbols', emojis: ['â¤ï¸', 'ğŸ§¡', 'ğŸ’›', 'ğŸ’š', 'ğŸ’™', 'ğŸ’œ', 'ğŸ–¤', 'ğŸ¤', 'ğŸ¤', 'ğŸ’”', 'â£ï¸', 'ğŸ’•', 'ğŸ’', 'ğŸ’“', 'ğŸ’—', 'ğŸ’–', 'ğŸ’˜', 'ğŸ’', 'ğŸ’Ÿ', 'â˜®ï¸', 'âœï¸', 'â˜ªï¸', 'ğŸ•‰ï¸', 'â˜¸ï¸', 'âœ¡ï¸', 'ğŸ”¯', 'ğŸ•', 'â˜¯ï¸', 'â˜¦ï¸', 'ğŸ›', 'â›', 'â™ˆ', 'â™‰', 'â™Š', 'â™‹', 'â™Œ', 'â™', 'â™', 'â™', 'â™', 'â™‘', 'â™’', 'â™“', 'ğŸ†”', 'âš›ï¸', 'ğŸ‰‘', 'â˜¢ï¸', 'â˜£ï¸', 'ğŸ“´', 'ğŸ“³', 'ğŸˆ¶', 'ğŸˆš', 'ğŸˆ¸', 'ğŸˆº', 'ğŸˆ·ï¸', 'âœ´ï¸', 'ğŸ†š', 'ğŸ’®', 'ğŸ‰', 'ãŠ™ï¸', 'ãŠ—ï¸', 'ğŸˆ´', 'ğŸˆµ', 'ğŸˆ¹', 'ğŸˆ²', 'ğŸ…°ï¸', 'ğŸ…±ï¸', 'ğŸ†', 'ğŸ†‘', 'ğŸ…¾ï¸', 'ğŸ†˜', 'âŒ', 'â­•', 'ğŸ›‘', 'â›”', 'ğŸ“›', 'ğŸš«', 'ğŸ’¯', 'ğŸ’¢', 'â™¨ï¸', 'ğŸš·', 'ğŸš¯', 'ğŸš³', 'ğŸš±', 'ğŸ”', 'ğŸ“µ', 'ğŸš­', 'â—', 'â•', 'â“', 'â”', 'â€¼ï¸', 'â‰ï¸', 'ğŸ”…', 'ğŸ”†', 'ã€½ï¸', 'âš ï¸', 'ğŸš¸', 'ğŸ”±', 'âšœï¸', 'ğŸ”°', 'â™»ï¸', 'âœ…', 'ğŸˆ¯', 'ğŸ’¹', 'â‡ï¸', 'âœ³ï¸', 'â', 'ğŸŒ', 'ğŸ’ ', 'â“‚ï¸', 'ğŸŒ€', 'ğŸ’¤', 'ğŸ§', 'ğŸš¾', 'â™¿', 'ğŸ…¿ï¸', 'ğŸˆ³', 'ğŸˆ‚ï¸', 'ğŸ›‚', 'ğŸ›ƒ', 'ğŸ›„', 'ğŸ›…', 'ğŸš¹', 'ğŸšº', 'ğŸš¼', 'ğŸš»', 'ğŸš®', 'ğŸ¦', 'ğŸ“¶', 'ğŸˆ', 'ğŸ”£', 'â„¹ï¸', 'ğŸ”¤', 'ğŸ”¡', 'ğŸ” ', 'ğŸ†–', 'ğŸ†—', 'ğŸ†™', 'ğŸ†’', 'ğŸ†•', 'ğŸ†“', '0ï¸âƒ£', '1ï¸âƒ£', '2ï¸âƒ£', '3ï¸âƒ£', '4ï¸âƒ£', '5ï¸âƒ£', '6ï¸âƒ£', '7ï¸âƒ£', '8ï¸âƒ£', '9ï¸âƒ£', 'ğŸ”Ÿ'] },
  { name: 'Flags', emojis: ['ğŸ', 'ğŸš©', 'ğŸŒ', 'ğŸ´', 'ğŸ³ï¸', 'ğŸ³ï¸â€ğŸŒˆ', 'ğŸ³ï¸â€âš§ï¸', 'ğŸ´â€â˜ ï¸', 'ğŸ‡¦ğŸ‡¨', 'ğŸ‡¦ğŸ‡©', 'ğŸ‡¦ğŸ‡ª', 'ğŸ‡¦ğŸ‡«', 'ğŸ‡¦ğŸ‡¬', 'ğŸ‡¦ğŸ‡®', 'ğŸ‡¦ğŸ‡±', 'ğŸ‡¦ğŸ‡²', 'ğŸ‡¦ğŸ‡´', 'ğŸ‡¦ğŸ‡¶', 'ğŸ‡¦ğŸ‡·', 'ğŸ‡¦ğŸ‡¸', 'ğŸ‡¦ğŸ‡¹', 'ğŸ‡¦ğŸ‡º', 'ğŸ‡¦ğŸ‡¼', 'ğŸ‡¦ğŸ‡½', 'ğŸ‡¦ğŸ‡¿', 'ğŸ‡§ğŸ‡¦', 'ğŸ‡§ğŸ‡§', 'ğŸ‡§ğŸ‡©', 'ğŸ‡§ğŸ‡ª', 'ğŸ‡§ğŸ‡«', 'ğŸ‡§ğŸ‡¬', 'ğŸ‡§ğŸ‡­', 'ğŸ‡§ğŸ‡®', 'ğŸ‡§ğŸ‡¯', 'ğŸ‡§ğŸ‡±', 'ğŸ‡§ğŸ‡²', 'ğŸ‡§ğŸ‡³', 'ğŸ‡§ğŸ‡´', 'ğŸ‡§ğŸ‡¶', 'ğŸ‡§ğŸ‡·', 'ğŸ‡§ğŸ‡¸', 'ğŸ‡§ğŸ‡¹', 'ğŸ‡§ğŸ‡»', 'ğŸ‡§ğŸ‡¼', 'ğŸ‡§ğŸ‡¾', 'ğŸ‡§ğŸ‡¿', 'ğŸ‡¨ğŸ‡¦', 'ğŸ‡¨ğŸ‡¨', 'ğŸ‡¨ğŸ‡©', 'ğŸ‡¨ğŸ‡«', 'ğŸ‡¨ğŸ‡¬', 'ğŸ‡¨ğŸ‡­', 'ğŸ‡¨ğŸ‡®', 'ğŸ‡¨ğŸ‡°', 'ğŸ‡¨ğŸ‡±', 'ğŸ‡¨ğŸ‡²', 'ğŸ‡¨ğŸ‡³', 'ğŸ‡¨ğŸ‡´', 'ğŸ‡¨ğŸ‡·', 'ğŸ‡¨ğŸ‡º', 'ğŸ‡¨ğŸ‡»', 'ğŸ‡¨ğŸ‡¼', 'ğŸ‡¨ğŸ‡½', 'ğŸ‡¨ğŸ‡¾', 'ğŸ‡¨ğŸ‡¿', 'ğŸ‡©ğŸ‡ª', 'ğŸ‡©ğŸ‡¬', 'ğŸ‡©ğŸ‡¯', 'ğŸ‡©ğŸ‡°', 'ğŸ‡©ğŸ‡²', 'ğŸ‡©ğŸ‡´', 'ğŸ‡©ğŸ‡¿', 'ğŸ‡ªğŸ‡¦', 'ğŸ‡ªğŸ‡¨', 'ğŸ‡ªğŸ‡ª', 'ğŸ‡ªğŸ‡¬', 'ğŸ‡ªğŸ‡­', 'ğŸ‡ªğŸ‡·', 'ğŸ‡ªğŸ‡¸', 'ğŸ‡ªğŸ‡¹', 'ğŸ‡ªğŸ‡º', 'ğŸ‡«ğŸ‡®', 'ğŸ‡«ğŸ‡¯', 'ğŸ‡«ğŸ‡°', 'ğŸ‡«ğŸ‡²', 'ğŸ‡«ğŸ‡´', 'ğŸ‡«ğŸ‡·', 'ğŸ‡¬ğŸ‡¦', 'ğŸ‡¬ğŸ‡§', 'ğŸ‡¬ğŸ‡©', 'ğŸ‡¬ğŸ‡ª', 'ğŸ‡¬ğŸ‡«', 'ğŸ‡¬ğŸ‡¬', 'ğŸ‡¬ğŸ‡­', 'ğŸ‡¬ğŸ‡®', 'ğŸ‡¬ğŸ‡±', 'ğŸ‡¬ğŸ‡²', 'ğŸ‡¬ğŸ‡³', 'ğŸ‡¬ğŸ‡µ', 'ğŸ‡¬ğŸ‡¶', 'ğŸ‡¬ğŸ‡·', 'ğŸ‡¬ğŸ‡¸', 'ğŸ‡¬ğŸ‡¹', 'ğŸ‡¬ğŸ‡º', 'ğŸ‡¬ğŸ‡¼', 'ğŸ‡¬ğŸ‡¾', 'ğŸ‡­ğŸ‡°', 'ğŸ‡­ğŸ‡²', 'ğŸ‡­ğŸ‡³', 'ğŸ‡­ğŸ‡·', 'ğŸ‡­ğŸ‡¹', 'ğŸ‡­ğŸ‡º', 'ğŸ‡®ğŸ‡¨', 'ğŸ‡®ğŸ‡©', 'ğŸ‡®ğŸ‡ª', 'ğŸ‡®ğŸ‡±', 'ğŸ‡®ğŸ‡²', 'ğŸ‡®ğŸ‡³', 'ğŸ‡®ğŸ‡´', 'ğŸ‡®ğŸ‡¶', 'ğŸ‡®ğŸ‡·', 'ğŸ‡®ğŸ‡¸', 'ğŸ‡®ğŸ‡¹', 'ğŸ‡¯ğŸ‡ª', 'ğŸ‡¯ğŸ‡²', 'ğŸ‡¯ğŸ‡´', 'ğŸ‡¯ğŸ‡µ', 'ğŸ‡°ğŸ‡ª', 'ğŸ‡°ğŸ‡¬', 'ğŸ‡°ğŸ‡­', 'ğŸ‡°ğŸ‡®', 'ğŸ‡°ğŸ‡²', 'ğŸ‡°ğŸ‡³', 'ğŸ‡°ğŸ‡µ', 'ğŸ‡°ğŸ‡·', 'ğŸ‡°ğŸ‡¼', 'ğŸ‡°ğŸ‡¾', 'ğŸ‡°ğŸ‡¿', 'ğŸ‡±ğŸ‡¦', 'ğŸ‡±ğŸ‡§', 'ğŸ‡±ğŸ‡¨', 'ğŸ‡±ğŸ‡®', 'ğŸ‡±ğŸ‡°', 'ğŸ‡±ğŸ‡·', 'ğŸ‡±ğŸ‡¸', 'ğŸ‡±ğŸ‡¹', 'ğŸ‡±ğŸ‡º', 'ğŸ‡±ğŸ‡»', 'ğŸ‡±ğŸ‡¾', 'ğŸ‡²ğŸ‡¦', 'ğŸ‡²ğŸ‡¨', 'ğŸ‡²ğŸ‡©', 'ğŸ‡²ğŸ‡ª', 'ğŸ‡²ğŸ‡«', 'ğŸ‡²ğŸ‡¬', 'ğŸ‡²ğŸ‡­', 'ğŸ‡²ğŸ‡°', 'ğŸ‡²ğŸ‡±', 'ğŸ‡²ğŸ‡²', 'ğŸ‡²ğŸ‡³', 'ğŸ‡²ğŸ‡´', 'ğŸ‡²ğŸ‡µ', 'ğŸ‡²ğŸ‡¶', 'ğŸ‡²ğŸ‡·', 'ğŸ‡²ğŸ‡¸', 'ğŸ‡²ğŸ‡¹', 'ğŸ‡²ğŸ‡º', 'ğŸ‡²ğŸ‡»', 'ğŸ‡²ğŸ‡¼', 'ğŸ‡²ğŸ‡½', 'ğŸ‡²ğŸ‡¾', 'ğŸ‡²ğŸ‡¿', 'ğŸ‡³ğŸ‡¦', 'ğŸ‡³ğŸ‡¨', 'ğŸ‡³ğŸ‡ª', 'ğŸ‡³ğŸ‡«', 'ğŸ‡³ğŸ‡¬', 'ğŸ‡³ğŸ‡®', 'ğŸ‡³ğŸ‡±', 'ğŸ‡³ğŸ‡´', 'ğŸ‡³ğŸ‡µ', 'ğŸ‡³ğŸ‡·', 'ğŸ‡³ğŸ‡º', 'ğŸ‡³ğŸ‡¿', 'ğŸ‡´ğŸ‡²', 'ğŸ‡µğŸ‡¦', 'ğŸ‡µğŸ‡ª', 'ğŸ‡µğŸ‡«', 'ğŸ‡µğŸ‡¬', 'ğŸ‡µğŸ‡­', 'ğŸ‡µğŸ‡°', 'ğŸ‡µğŸ‡±', 'ğŸ‡µğŸ‡²', 'ğŸ‡µğŸ‡³', 'ğŸ‡µğŸ‡·', 'ğŸ‡µğŸ‡¸', 'ğŸ‡µğŸ‡¹', 'ğŸ‡µğŸ‡¼', 'ğŸ‡µğŸ‡¾', 'ğŸ‡¶ğŸ‡¦', 'ğŸ‡·ğŸ‡ª', 'ğŸ‡·ğŸ‡´', 'ğŸ‡·ğŸ‡¸', 'ğŸ‡·ğŸ‡º', 'ğŸ‡·ğŸ‡¼', 'ğŸ‡¸ğŸ‡¦', 'ğŸ‡¸ğŸ‡§', 'ğŸ‡¸ğŸ‡¨', 'ğŸ‡¸ğŸ‡©', 'ğŸ‡¸ğŸ‡ª', 'ğŸ‡¸ğŸ‡¬', 'ğŸ‡¸ğŸ‡­', 'ğŸ‡¸ğŸ‡®', 'ğŸ‡¸ğŸ‡¯', 'ğŸ‡¸ğŸ‡°', 'ğŸ‡¸ğŸ‡±', 'ğŸ‡¸ğŸ‡²', 'ğŸ‡¸ğŸ‡³', 'ğŸ‡¸ğŸ‡´', 'ğŸ‡¸ğŸ‡·', 'ğŸ‡¸ğŸ‡¸', 'ğŸ‡¸ğŸ‡¹', 'ğŸ‡¸ğŸ‡»', 'ğŸ‡¸ğŸ‡½', 'ğŸ‡¸ğŸ‡¾', 'ğŸ‡¸ğŸ‡¿', 'ğŸ‡¹ğŸ‡¦', 'ğŸ‡¹ğŸ‡¨', 'ğŸ‡¹ğŸ‡©', 'ğŸ‡¹ğŸ‡«', 'ğŸ‡¹ğŸ‡¬', 'ğŸ‡¹ğŸ‡­', 'ğŸ‡¹ğŸ‡¯', 'ğŸ‡¹ğŸ‡°', 'ğŸ‡¹ğŸ‡±', 'ğŸ‡¹ğŸ‡²', 'ğŸ‡¹ğŸ‡³', 'ğŸ‡¹ğŸ‡´', 'ğŸ‡¹ğŸ‡·', 'ğŸ‡¹ğŸ‡¹', 'ğŸ‡¹ğŸ‡»', 'ğŸ‡¹ğŸ‡¼', 'ğŸ‡¹ğŸ‡¿', 'ğŸ‡ºğŸ‡¦', 'ğŸ‡ºğŸ‡¬', 'ğŸ‡ºğŸ‡²', 'ğŸ‡ºğŸ‡³', 'ğŸ‡ºğŸ‡¸', 'ğŸ‡ºğŸ‡¾', 'ğŸ‡ºğŸ‡¿', 'ğŸ‡»ğŸ‡¦', 'ğŸ‡»ğŸ‡¨', 'ğŸ‡»ğŸ‡ª', 'ğŸ‡»ğŸ‡¬', 'ğŸ‡»ğŸ‡®', 'ğŸ‡»ğŸ‡³', 'ğŸ‡»ğŸ‡º', 'ğŸ‡¼ğŸ‡«', 'ğŸ‡¼ğŸ‡¸', 'ğŸ‡½ğŸ‡°', 'ğŸ‡¾ğŸ‡ª', 'ğŸ‡¾ğŸ‡¹', 'ğŸ‡¿ğŸ‡¦', 'ğŸ‡¿ğŸ‡²', 'ğŸ‡¿ğŸ‡¼'] }
];

// Get GIPHY API key from environment
const GIPHY_API_KEY = process.env.EXPO_PUBLIC_GIPHY_API_KEY;
const GIPHY_BASE_URL = 'https://api.giphy.com/v1/gifs';

const screenWidth = Dimensions.get('window').width;
const screenHeight = Dimensions.get('window').height;

// Calculate emoji button size - ensure minimum 40px for visibility on mobile
const emojiButtonSize = Math.max((screenWidth * 0.9 - 48) / 7, 40);
const emojiFontSize = Math.max(screenWidth * 0.05, 28);

export const EmojiGifPickerModal: React.FC<EmojiGifPickerModalProps> = ({
  onEmojiSelect,
  onGifSelect,
  onClose,
  isOpen,
  initialTab = 'emoji',
}) => {
  const { theme } = usePreferences();
  const themeColors = theme === 'dark' ? darkColors : lightColors;
  const styles = React.useMemo(() => createStyles(theme, themeColors), [theme, themeColors]);
  
  const [activeTab, setActiveTab] = useState<'emoji' | 'gif'>(initialTab);
  const [selectedCategory, setSelectedCategory] = useState(0);
  const [searchQuery, setSearchQuery] = useState('');
  const [gifs, setGifs] = useState<GifData[]>([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [gifOffset, setGifOffset] = useState(0);
  const [hasMoreGifs, setHasMoreGifs] = useState(true);
  const scrollViewRef = useRef<ScrollView>(null);

  // Reset to initial tab when modal opens
  useEffect(() => {
    if (isOpen) {
      setActiveTab(initialTab);
      if (initialTab === 'gif' && gifs.length === 0) {
        fetchTrendingGifs();
      }
    }
  }, [isOpen, initialTab]);

  // Filter emojis based on search query
  const filteredEmojis = EMOJI_CATEGORIES[selectedCategory].emojis.filter(emoji =>
    emoji.toLowerCase().includes(searchQuery.toLowerCase())
  );

  const fetchTrendingGifs = async (offset = 0) => {
    if (!GIPHY_API_KEY) {
      setError('GIPHY API key not configured. Please add EXPO_PUBLIC_GIPHY_API_KEY to your environment variables.');
      return;
    }

    setLoading(true);
    setError(null);
    try {
      const response = await fetch(`${GIPHY_BASE_URL}/trending?api_key=${GIPHY_API_KEY}&limit=20&offset=${offset}`);
      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.message || `HTTP ${response.status}: ${response.statusText}`);
      }

      if (data.data) {
        if (offset === 0) {
          setGifs(data.data);
        } else {
          setGifs(prev => [...prev, ...data.data]);
        }
        setGifOffset(offset + 20);
        setHasMoreGifs(data.data.length === 20);
      }
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'Failed to load GIFs';
      setError(errorMessage);
      console.error('Error fetching trending GIFs:', err);
    } finally {
      setLoading(false);
    }
  };

  const searchGifs = async (query: string, offset = 0) => {
    if (!query.trim()) {
      fetchTrendingGifs(offset);
      return;
    }

    if (!GIPHY_API_KEY) {
      setError('GIPHY API key not configured.');
      return;
    }

    setLoading(true);
    setError(null);
    try {
      const response = await fetch(`${GIPHY_BASE_URL}/search?api_key=${GIPHY_API_KEY}&q=${encodeURIComponent(query)}&limit=20&offset=${offset}`);
      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.message || `HTTP ${response.status}: ${response.statusText}`);
      }

      if (data.data) {
        if (offset === 0) {
          setGifs(data.data);
        } else {
          setGifs(prev => [...prev, ...data.data]);
        }
        setGifOffset(offset + 20);
        setHasMoreGifs(data.data.length === 20);
      }
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'Failed to search GIFs';
      setError(errorMessage);
      console.error('Error searching GIFs:', err);
    } finally {
      setLoading(false);
    }
  };

  const handleSearch = () => {
    setGifOffset(0);
    if (activeTab === 'gif') {
      searchGifs(searchQuery, 0);
    }
  };

  const handleLoadMoreGifs = () => {
    if (!loading && hasMoreGifs) {
      if (searchQuery.trim()) {
        searchGifs(searchQuery, gifOffset);
      } else {
        fetchTrendingGifs(gifOffset);
      }
    }
  };

  const renderGifItem = ({ item }: { item: GifData }) => {
    const imageUrl = item.images.fixed_width?.url || 
                    item.images.downsized_medium?.url || 
                    item.images.downsized?.url || 
                    item.images.original.url;

    return (
      <TouchableOpacity
        style={styles.gifItem}
        onPress={() => onGifSelect(item.images.original.url, item.title)}
        activeOpacity={0.7}
      >
        <Image
          source={{ uri: imageUrl }}
          style={styles.gifImage}
          resizeMode="contain"
        />
      </TouchableOpacity>
    );
  };

  if (!isOpen) return null;

  return (
    <Modal
      visible={isOpen}
      transparent
      animationType="slide"
      onRequestClose={onClose}
    >
      <View style={styles.modalOverlay}>
        <View style={styles.modalContent}>
          {/* Header */}
          <View style={styles.header}>
            <Text style={styles.headerTitle}>
              {activeTab === 'emoji' ? 'Emoji' : 'GIFs'}
            </Text>
            <TouchableOpacity onPress={onClose} style={styles.closeButton} activeOpacity={0.7}>
              <Text style={styles.closeButtonText}>âœ•</Text>
            </TouchableOpacity>
          </View>

          {/* Tabs */}
          <View style={styles.tabContainer}>
            <TouchableOpacity
              style={[styles.tab, activeTab === 'emoji' && styles.tabActive]}
              onPress={() => setActiveTab('emoji')}
            >
              <Text style={[styles.tabText, activeTab === 'emoji' && styles.tabTextActive]}>
                ğŸ˜Š Emoji
              </Text>
            </TouchableOpacity>
            <TouchableOpacity
              style={[styles.tab, activeTab === 'gif' && styles.tabActive]}
              onPress={() => {
                setActiveTab('gif');
                if (gifs.length === 0) {
                  fetchTrendingGifs();
                }
              }}
            >
              <Text style={[styles.tabText, activeTab === 'gif' && styles.tabTextActive]}>
                ğŸ¬ GIFs
              </Text>
            </TouchableOpacity>
          </View>

          {/* Search */}
          {activeTab === 'gif' && (
            <View style={styles.searchContainer}>
              <TextInput
                style={styles.searchInput}
                placeholder="Search GIFs..."
                placeholderTextColor={themeColors.textMuted}
                value={searchQuery}
                onChangeText={setSearchQuery}
                onSubmitEditing={handleSearch}
                returnKeyType="search"
              />
              <TouchableOpacity
                style={styles.searchButton}
                onPress={handleSearch}
                disabled={loading || !GIPHY_API_KEY}
              >
                <Text style={styles.searchButtonText}>Search</Text>
              </TouchableOpacity>
            </View>
          )}

          {/* Content */}
          <View style={styles.content}>
            {activeTab === 'emoji' ? (
              <>
                {/* Categories */}
                <ScrollView
                  horizontal
                  showsHorizontalScrollIndicator={false}
                  style={styles.categoryScroll}
                  contentContainerStyle={styles.categoryContainer}
                >
                  {EMOJI_CATEGORIES.map((category, index) => (
                    <TouchableOpacity
                      key={index}
                      style={[
                        styles.categoryButton,
                        selectedCategory === index && styles.categoryButtonActive,
                      ]}
                      onPress={() => setSelectedCategory(index)}
                    >
                      <Text
                        style={[
                          styles.categoryText,
                          selectedCategory === index && styles.categoryTextActive,
                        ]}
                      >
                        {category.name}
                      </Text>
                    </TouchableOpacity>
                  ))}
                </ScrollView>

                {/* Emojis Grid */}
                <ScrollView style={styles.emojiScroll} contentContainerStyle={styles.emojiGrid}>
                  {filteredEmojis.map((emoji, index) => (
                    <TouchableOpacity
                      key={index}
                      style={styles.emojiButton}
                      onPress={() => onEmojiSelect(emoji)}
                      activeOpacity={0.7}
                    >
                      <Text style={styles.emojiText}>{emoji}</Text>
                    </TouchableOpacity>
                  ))}
                </ScrollView>
              </>
            ) : (
              <>
                {/* GIFs Grid */}
                {loading && gifs.length === 0 ? (
                  <View style={styles.loadingContainer}>
                    <ActivityIndicator size="large" color={themeColors.primary} />
                  </View>
                ) : error ? (
                  <View style={styles.errorContainer}>
                    <Text style={styles.errorText}>{error}</Text>
                    {error.includes('API key') ? (
                      <Text style={styles.errorHint}>
                        Add EXPO_PUBLIC_GIPHY_API_KEY to your .env file
                      </Text>
                    ) : (
                      <TouchableOpacity
                        style={styles.retryButton}
                        onPress={() => fetchTrendingGifs()}
                      >
                        <Text style={styles.retryButtonText}>Try Again</Text>
                      </TouchableOpacity>
                    )}
                  </View>
                ) : gifs.length === 0 ? (
                  <View style={styles.errorContainer}>
                    <Text style={styles.errorText}>No GIFs found</Text>
                  </View>
                ) : (
                  <FlatList
                    data={gifs}
                    renderItem={renderGifItem}
                    keyExtractor={(item, index) => `${item.id}-${index}`}
                    numColumns={2}
                    onEndReached={handleLoadMoreGifs}
                    onEndReachedThreshold={0.5}
                    ListFooterComponent={
                      loading && gifs.length > 0 ? (
                        <View style={styles.loadingFooter}>
                          <ActivityIndicator size="small" color={themeColors.primary} />
                        </View>
                      ) : null
                    }
                    style={styles.gifList}
                    contentContainerStyle={styles.gifGrid}
                  />
                )}
              </>
            )}
          </View>

          {/* Footer */}
          {activeTab === 'gif' && (
            <View style={styles.footer}>
              <Text style={styles.footerText}>Powered by GIPHY</Text>
            </View>
          )}
        </View>
      </View>
    </Modal>
  );
};

const createStyles = (theme: 'light' | 'dark', themeColors: typeof lightColors) => StyleSheet.create({
  modalOverlay: {
    flex: 1,
    backgroundColor: theme === 'dark' ? 'rgba(0, 0, 0, 0.8)' : 'rgba(0, 0, 0, 0.5)',
    justifyContent: 'center',
    alignItems: 'center',
  },
  modalContent: {
    width: screenWidth * 0.9,
    maxWidth: 400,
    height: screenHeight * 0.7,
    maxHeight: 600,
    backgroundColor: themeColors.background,
    borderRadius: 20,
    overflow: 'hidden',
    ...Platform.select({
      ios: {
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 2 },
        shadowOpacity: 0.25,
        shadowRadius: 3.84,
      },
      android: {
        elevation: 5,
      },
    }),
  },
  header: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    padding: 16,
    borderBottomWidth: 1,
    borderBottomColor: themeColors.border,
  },
  headerTitle: {
    fontSize: 18,
    fontWeight: '600',
    color: themeColors.text,
  },
  closeButton: {
    padding: 8,
    borderRadius: 20,
    backgroundColor: themeColors.textMuted,
    minWidth: 36,
    minHeight: 36,
    justifyContent: 'center',
    alignItems: 'center',
  },
  closeButtonText: {
    color: '#fff',
    fontSize: 20,
    fontWeight: '600',
    lineHeight: 20,
  },
  tabContainer: {
    flexDirection: 'row',
    borderBottomWidth: 1,
    borderBottomColor: themeColors.border,
  },
  tab: {
    flex: 1,
    paddingVertical: 12,
    alignItems: 'center',
    borderBottomWidth: 2,
    borderBottomColor: 'transparent',
  },
  tabActive: {
    borderBottomColor: themeColors.primary,
  },
  tabText: {
    fontSize: 14,
    fontWeight: '500',
    color: themeColors.textMuted,
  },
  tabTextActive: {
    color: themeColors.primary,
    fontWeight: '600',
  },
  searchContainer: {
    flexDirection: 'row',
    padding: 12,
    borderBottomWidth: 1,
    borderBottomColor: themeColors.border,
    gap: 8,
  },
  searchInput: {
    flex: 1,
    height: 40,
    backgroundColor: themeColors.muted,
    borderRadius: 8,
    paddingHorizontal: 12,
    color: themeColors.text,
    fontSize: 14,
  },
  searchButton: {
    paddingHorizontal: 16,
    paddingVertical: 8,
    backgroundColor: themeColors.primary,
    borderRadius: 8,
    justifyContent: 'center',
  },
  searchButtonText: {
    color: '#fff',
    fontWeight: '600',
    fontSize: 14,
  },
  content: {
    flex: 1,
  },
  categoryScroll: {
    borderBottomWidth: 1,
    borderBottomColor: themeColors.border,
  },
  categoryContainer: {
    paddingHorizontal: 8,
    paddingVertical: 6,
  },
  categoryButton: {
    paddingHorizontal: 8,
    paddingVertical: 4,
    marginHorizontal: 4,
    borderRadius: 12,
    backgroundColor: themeColors.muted,
  },
  categoryButtonActive: {
    backgroundColor: themeColors.primary,
  },
  categoryText: {
    fontSize: 11,
    color: themeColors.textMuted,
  },
  categoryTextActive: {
    color: '#fff',
    fontWeight: '600',
  },
  emojiScroll: {
    flex: 1,
  },
  emojiGrid: {
    flexDirection: 'row',
    flexWrap: 'wrap',
    padding: 12,
    justifyContent: 'flex-start',
  },
  emojiButton: {
    width: emojiButtonSize,
    height: emojiButtonSize,
    minWidth: 40,
    minHeight: 40,
    justifyContent: 'center',
    alignItems: 'center',
  },
  emojiText: {
    fontSize: emojiFontSize,
  },
  gifList: {
    flex: 1,
  },
  gifGrid: {
    padding: 8,
  },
  gifItem: {
    width: (screenWidth * 0.9 - 48) / 2,
    height: 140,
    margin: 4,
    borderRadius: 8,
    overflow: 'hidden',
    backgroundColor: themeColors.muted,
    justifyContent: 'center',
    alignItems: 'center',
  },
  gifImage: {
    width: '100%',
    height: '100%',
  },
  loadingContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
  },
  loadingFooter: {
    paddingVertical: 16,
    alignItems: 'center',
  },
  errorContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    padding: 24,
  },
  errorText: {
    fontSize: 14,
    color: themeColors.textMuted,
    textAlign: 'center',
    marginBottom: 8,
  },
  errorHint: {
    fontSize: 12,
    color: themeColors.textMuted,
    textAlign: 'center',
    marginTop: 8,
  },
  retryButton: {
    marginTop: 16,
    paddingHorizontal: 16,
    paddingVertical: 8,
    backgroundColor: themeColors.primary,
    borderRadius: 8,
  },
  retryButtonText: {
    color: '#fff',
    fontWeight: '600',
    fontSize: 14,
  },
  footer: {
    padding: 12,
    borderTopWidth: 1,
    borderTopColor: themeColors.border,
    alignItems: 'center',
  },
  footerText: {
    fontSize: 12,
    color: themeColors.textMuted,
  },
});

